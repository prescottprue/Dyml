/*! Copyright 2011 Trigger Corp. All rights reserved. */
(function(){var n={};var o={};n.config=window.forge.config;o.listeners={};o.eventQueue={};o.queueEvents=true;var q={};var j=[];var h=null;var a=false;var t=function(){if(j.length>0){if(!o.debug||window.catalystConnected){a=true;while(j.length>0){var u=j.shift();if(u[0]=="logging.log"){console.log(u[1].message)}o.priv.call.apply(o.priv,u)}a=false}else{h=setTimeout(t,500)}}};o.priv={call:function(B,A,z,v){if((!o.debug||window.catalystConnected||B==="internal.showDebugWarning")&&(j.length===0||a)){var u=n.tools.UUID();var x=true;if(B==="button.onClicked.addListener"||B==="message.toFocussed"){x=false}if(z||v){q[u]={success:z,error:v,onetime:x}}var w={callid:u,method:B,params:A};o.priv.send(w);if(window._forgeDebug){try{w.start=(new Date().getTime())/1000;window._forgeDebug.forge.APICall.apiRequest(w)}catch(y){}}}else{j.push(arguments);if(!h){h=setTimeout(t,500)}}},send:function(){throw new Error("Forge error: missing bridge to privileged code")},lastResult:undefined,receive:function(u,v){if(v!==undefined&&v===o.priv.lastResult){return"success"}o.priv.lastResult=v;if(u.callid){if(typeof q[u.callid]===undefined){n.log("Nothing stored for call ID: "+u.callid)}var w=q[u.callid];if(w&&w[u.status]){w[u.status](u.content)}if(w&&w.onetime){delete q[u.callid]}if(window._forgeDebug){try{u.end=(new Date().getTime())/1000;window._forgeDebug.forge.APICall.apiResponse(u)}catch(x){}}}else{if(u.event){if(o.listeners[u.event]){o.listeners[u.event].forEach(function(y){if(u.params){y(u.params)}else{y()}})}else{if(o.queueEvents){if(o.eventQueue[u.event]){o.eventQueue[u.event].push(u.params)}else{o.eventQueue[u.event]=[u.params]}}}if(o.listeners["*"]){o.listeners["*"].forEach(function(y){if(u.params){y(u.event,u.params)}else{y(u.event)}})}if(window._forgeDebug){try{u.start=(new Date().getTime())/1000;window._forgeDebug.forge.APICall.apiEvent(u)}catch(x){}}}}return"success"}};setTimeout(function(){o.queueEvents=false;o.eventQueue={}},30000);o.addEventListener=function(u,v){if(o.listeners[u]){o.listeners[u].push(v)}else{o.listeners[u]=[v]}if(o.eventQueue[u]){o.eventQueue[u].forEach(function(w){v(w)});delete o.eventQueue[u]}};o.generateQueryString=function(v){if(!v){return""}if(!(v instanceof Object)){return new String(v).toString()}var w=[];var u=function(C,B){if(C===null){return}else{if(C instanceof Array){var z=0;for(var y in C){var A=(B?B:"")+"["+z+"]";z+=1;if(!C.hasOwnProperty(y)){continue}u(C[y],A)}}else{if(C instanceof Object){for(var y in C){if(!C.hasOwnProperty(y)){continue}var A=y;if(B){A=B+"["+y+"]"}u(C[y],A)}}else{w.push(encodeURIComponent(B)+"="+encodeURIComponent(C))}}}};u(v);return w.join("&").replace("%20","+")};o.generateMultipartString=function(v,x){if(typeof v==="string"){return""}var w="";for(var u in v){if(!v.hasOwnProperty(u)){continue}if(v[u]===null){continue}w+="--"+x+"\r\n";w+='Content-Disposition: form-data; name="'+u.replace('"','\\"')+'"\r\n\r\n';w+=v[u].toString()+"\r\n"}return w};o.generateURI=function(v,u){var w="";if(v.indexOf("?")!==-1){w+=v.split("?")[1]+"&";v=v.split("?")[0]}w+=this.generateQueryString(u)+"&";w=w.substring(0,w.length-1);return v+(w?"?"+w:"")};o.disabledModule=function(u,v){var w="The '"+v+"' module is disabled for this app, enable it in your app config and rebuild in order to use this function";n.logging.error(w);u&&u({message:w,type:"UNAVAILABLE",subtype:"DISABLED_MODULE"})};n.enableDebug=function(){o.debug=true;o.priv.call("internal.showDebugWarning",{},null,null);o.priv.call("internal.hideDebugWarning",{},null,null)};setTimeout(function(){if(window.forge&&window.forge.debug){alert("Warning!\n\n'forge.debug = true;' is no longer supported\n\nUse 'forge.enableDebug();' instead.")}},3000);n.is={mobile:function(){return false},desktop:function(){return false},android:function(){return false},ios:function(){return false},chrome:function(){return false},firefox:function(){return false},safari:function(){return false},ie:function(){return false},web:function(){return false},orientation:{portrait:function(){return false},landscape:function(){return false}},connection:{connected:function(){return true},wifi:function(){return true}}};n.is["mobile"]=function(){return true};n.is["ios"]=function(){return true};n.is["orientation"]["portrait"]=function(){return o.currentOrientation=="portrait"};n.is["orientation"]["landscape"]=function(){return o.currentOrientation=="landscape"};n.is["connection"]["connected"]=function(){return o.currentConnectionState.connected};n.is["connection"]["wifi"]=function(){return o.currentConnectionState.wifi};var k=function(A,y,B){var w=[];stylize=function(D,C){return D};function u(C){return C instanceof RegExp||(typeof C==="object"&&Object.prototype.toString.call(C)==="[object RegExp]")}function v(C){return C instanceof Array||Array.isArray(C)||(C&&C!==Object.prototype&&v(C.__proto__))}function x(E){if(E instanceof Date){return true}if(typeof E!=="object"){return false}var C=Date.prototype&&Object.getOwnPropertyNames(Date.prototype);var D=E.__proto__&&Object.getOwnPropertyNames(E.__proto__);return JSON.stringify(D)===JSON.stringify(C)}function z(O,L){try{if(O&&typeof O.inspect==="function"&&!(O.constructor&&O.constructor.prototype===O)){return O.inspect(L)}switch(typeof O){case"undefined":return stylize("undefined","undefined");case"string":var C="'"+JSON.stringify(O).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return stylize(C,"string");case"number":return stylize(""+O,"number");case"boolean":return stylize(""+O,"boolean")}if(O===null){return stylize("null","null")}if(O instanceof Document){return(new XMLSerializer()).serializeToString(O)}var I=Object.keys(O);var P=y?Object.getOwnPropertyNames(O):I;if(typeof O==="function"&&P.length===0){var D=O.name?": "+O.name:"";return stylize("[Function"+D+"]","special")}if(u(O)&&P.length===0){return stylize(""+O,"regexp")}if(x(O)&&P.length===0){return stylize(O.toUTCString(),"date")}var E,M,J;if(v(O)){M="Array";J=["[","]"]}else{M="Object";J=["{","}"]}if(typeof O==="function"){var H=O.name?": "+O.name:"";E=" [Function"+H+"]"}else{E=""}if(u(O)){E=" "+O}if(x(O)){E=" "+O.toUTCString()}if(P.length===0){return J[0]+E+J[1]}if(L<0){if(u(O)){return stylize(""+O,"regexp")}else{return stylize("[Object]","special")}}w.push(O);var G=P.map(function(R){var Q,S;if(O.__lookupGetter__){if(O.__lookupGetter__(R)){if(O.__lookupSetter__(R)){S=stylize("[Getter/Setter]","special")}else{S=stylize("[Getter]","special")}}else{if(O.__lookupSetter__(R)){S=stylize("[Setter]","special")}}}if(I.indexOf(R)<0){Q="["+R+"]"}if(!S){if(w.indexOf(O[R])<0){if(L===null){S=z(O[R])}else{S=z(O[R],L-1)}if(S.indexOf("\n")>-1){if(v(O)){S=S.split("\n").map(function(T){return"  "+T}).join("\n").substr(2)}else{S="\n"+S.split("\n").map(function(T){return"   "+T}).join("\n")}}}else{S=stylize("[Circular]","special")}}if(typeof Q==="undefined"){if(M==="Array"&&R.match(/^\d+$/)){return S}Q=JSON.stringify(""+R);if(Q.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){Q=Q.substr(1,Q.length-2);Q=stylize(Q,"name")}else{Q=Q.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");Q=stylize(Q,"string")}}return Q+": "+S});w.pop();var N=0;var F=G.reduce(function(Q,R){N++;if(R.indexOf("\n")>=0){N++}return Q+R.length+1},0);if(F>50){G=J[0]+(E===""?"":E+"\n ")+" "+G.join(",\n  ")+" "+J[1]}else{G=J[0]+E+" "+G.join(", ")+" "+J[1]}return G}catch(K){return"[No string representation]"}}return z(A,(typeof B==="undefined"?2:B))};var b=function(v,w){if("logging" in n.config){var u=n.config.logging.marker||"FORGE"}else{var u="FORGE"}v="["+u+"] "+(v.indexOf("\n")===-1?"":"\n")+v;o.priv.call("logging.log",{message:v,level:w});if(typeof console!=="undefined"){switch(w){case 10:if(console.debug!==undefined&&!(console.debug.toString&&console.debug.toString().match("alert"))){console.debug(v)}break;case 30:if(console.warn!==undefined&&!(console.warn.toString&&console.warn.toString().match("alert"))){console.warn(v)}break;case 40:case 50:if(console.error!==undefined&&!(console.error.toString&&console.error.toString().match("alert"))){console.error(v)}break;default:case 20:if(console.info!==undefined&&!(console.info.toString&&console.info.toString().match("alert"))){console.info(v)}break}}};var m=function(u,v){if(u in n.logging.LEVELS){return n.logging.LEVELS[u]}else{n.logging.__logMessage("Unknown configured logging level: "+u);return v}};var r=function(v){var y=function(z){if(z.message){return z.message}else{if(z.description){return z.description}else{return""+z}}};if(v){var x="\nError: "+y(v);try{if(v.lineNumber){x+=" on line number "+v.lineNumber}if(v.fileName){var u=v.fileName;x+=" in file "+u.substr(u.lastIndexOf("/")+1)}}catch(w){}if(v.stack){x+="\r\nStack trace:\r\n"+v.stack}return x}return""};n.logging={LEVELS:{ALL:0,DEBUG:10,INFO:20,WARNING:30,ERROR:40,CRITICAL:50},debug:function(v,u){n.logging.log(v,u,n.logging.LEVELS.DEBUG)},info:function(v,u){n.logging.log(v,u,n.logging.LEVELS.INFO)},warning:function(v,u){n.logging.log(v,u,n.logging.LEVELS.WARNING)},error:function(v,u){n.logging.log(v,u,n.logging.LEVELS.ERROR)},critical:function(v,u){n.logging.log(v,u,n.logging.LEVELS.CRITICAL)},log:function(v,u,y){if(typeof(y)==="undefined"){var y=n.logging.LEVELS.INFO}try{var w=m(n.config.core.general.logging.level,n.logging.LEVELS.ALL)}catch(x){var w=n.logging.LEVELS.ALL}if(y>=w){b(k(v,false,10)+r(u),y)}}};n.internal={ping:function(v,w,u){o.priv.call("internal.ping",{data:[v]},w,u)},call:o.priv.call,addEventListener:o.addEventListener,listeners:o.listeners,configForModule:function(u){return n.config.modules[n.module_mapping[u]].config}};var s={};o.currentOrientation=s;o.currentConnectionState=s;o.addEventListener("internal.orientationChange",function(u){if(o.currentOrientation!=u.orientation){o.currentOrientation=u.orientation;o.priv.receive({event:"event.orientationChange"})}});o.addEventListener("internal.connectionStateChange",function(u){if(u.connected!=o.currentConnectionState.connected||u.wifi!=o.currentConnectionState.wifi){o.currentConnectionState=u;o.priv.receive({event:"event.connectionStateChange"})}});n.event={menuPressed:{addListener:function(v,u){o.addEventListener("event.menuPressed",v)}},backPressed:{addListener:function(v,u){o.addEventListener("event.backPressed",function(){v(function(){o.priv.call("event.backPressed_closeApplication",{})})})},preventDefault:function(v,u){o.priv.call("event.backPressed_preventDefault",{},v,u)},restoreDefault:function(v,u){o.priv.call("event.backPressed_restoreDefault",{},v,u)}},messagePushed:{addListener:function(v,u){o.addEventListener("event.messagePushed",v)}},orientationChange:{addListener:function(v,u){o.addEventListener("event.orientationChange",v);if(typeof s!=="undefined"&&o.currentOrientation!==s){o.priv.receive({event:"event.orientationChange"})}}},connectionStateChange:{addListener:function(v,u){o.addEventListener("event.connectionStateChange",v)}},appPaused:{addListener:function(v,u){o.addEventListener("event.appPaused",v)}},appResumed:{addListener:function(v,u){o.addEventListener("event.appResumed",v)}},statusBarTapped:{addListener:function(v,u){o.addEventListener("event.statusBarTapped",v)}}};n.reload={updateAvailable:function(v,u){o.priv.call("reload.updateAvailable",{},v,u)},update:function(v,u){o.priv.call("reload.update",{},v,u)},pauseUpdate:function(v,u){o.priv.call("reload.pauseUpdate",{},v,u)},applyNow:function(v,u){n.logging.error("reload.applyNow has been disabled, please see docs.trigger.io for more information.");u({message:"reload.applyNow has been disabled, please see docs.trigger.io for more information.",type:"UNAVAILABLE"})},applyAndRestartApp:function(v,u){o.priv.call("reload.applyAndRestartApp",{},v,u)},switchStream:function(v,w,u){o.priv.call("reload.switchStream",{streamid:v},w,u)},updateReady:{addListener:function(v,u){o.addEventListener("reload.updateReady",v)}},updateProgress:{addListener:function(v,u){o.addEventListener("reload.updateProgress",v)}}};n.tools={UUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(x){var w=Math.random()*16|0;var u=x=="x"?w:(w&3|8);return u.toString(16)}).toUpperCase()},getURL:function(v,w,u){o.priv.call("tools.getURL",{name:v.toString()},w,u)}};var p=[];var g=false;o.priv.get=function(){var u=JSON.stringify(p);p=[];return u};var f=[],l="zero-timeout-message";function d(u){f.push(u);window.postMessage(l,"*")}function c(u){setTimeout(u,0)}function e(u){if(u.source==window&&u.data==l){if(u.stopPropagation){u.stopPropagation()}if(f.length){f.shift()()}}}if(window.postMessage){if(window.addEventListener){window.addEventListener("message",e,true)}else{if(window.attachEvent){window.attachEvent("onmessage",e)}}window.setZeroTimeout=d}else{window.setZeroTimeout=c}var i=function(){if(g&&!window.forge._flushing){window.forge._flushing=true;window.forge._flushingInterval=setInterval(function(){window.location.href="forge://go"},100);c(function(){window.location.href="forge://go"})}};o.priv.send=function(u){p.push(u);i()};document.addEventListener("DOMContentLoaded",function(){g=true;n.internal.call("internal.ping",{data:"hello"})},false);n._get=o.priv.get;n._receive=function(){var u=arguments;c(function(){o.priv.receive.apply(this,u)});return"success"};window.forge=n})();(function(){forge.topbar={show:function(b,a){forge.internal.call("topbar.show",{},b,a)},hide:function(b,a){forge.internal.call("topbar.hide",{},b,a)},setTitle:function(c,b,a){forge.internal.call("topbar.setTitle",{title:c},b,a)},setTitleImage:function(b,c,a){if(b&&b[0]==="/"){b=b.substr(1)}forge.internal.call("topbar.setTitleImage",{icon:b},c,a)},setTint:function(a,c,b){forge.internal.call("topbar.setTint",{color:a},c,b)},addButton:function(b,c,a){if(b.icon&&b.icon[0]==="/"){b.icon=b.icon.substr(1)}forge.internal.call("topbar.addButton",b,function(d){c&&forge.internal.addEventListener("topbar.buttonPressed."+d,c)},a)},removeButtons:function(b,a){forge.internal.call("topbar.removeButtons",{},b,a)},setStatusBarStyle:function(b,c,a){forge.internal.call("topbar.setStatusBarStyle",{style:b},c,a)}}})();(function(){forge.request={get:function(e,f,d){forge.request.ajax({url:e,dataType:"text",success:f&&function(){try{arguments[0]=JSON.parse(arguments[0])}catch(g){}f.apply(this,arguments)},error:d})}};var b=function(e){if(!e){return""}if(!(e instanceof Object)){return new String(e).toString()}var f=[];var d=function(m,l){if(m===null){return}else{if(m instanceof Array){var i=0;for(var g in m){var j=(l?l:"")+"["+i+"]";i+=1;if(!m.hasOwnProperty(g)){continue}d(m[g],j)}}else{if(m instanceof Object){for(var h in m){if(!m.hasOwnProperty(h)){continue}var k=h;if(l){k=l+"["+h+"]"}d(m[h],k)}}else{f.push(encodeURIComponent(l)+"="+encodeURIComponent(m))}}}};d(e);return f.join("&").replace("%20","+")};var a=function(e,d){var f="";if(e.indexOf("?")!==-1){f+=e.split("?")[1]+"&";e=e.split("?")[0]}f+=b(d)+"&";f=f.substring(0,f.length-1);return e+(f?"?"+f:"")};var c=function(h,k){if(typeof h==="string"){return""}var j="";for(var e in h){if(!h.hasOwnProperty(e)){continue}if(h[e]===null){continue}var g=h[e];if(Object.prototype.toString.call(g)==="[object Array]"){for(var d=0;d<g.length;d++){var f={};f[e+"["+d+"]"]=g[d];j+=c(f,k)}}else{j+="--"+k+"\r\n";j+='Content-Disposition: form-data; name="'+e.replace('"','\\"')+'"\r\n\r\n';j+=h[e].toString()+"\r\n"}}return j};forge.request["ajax"]=function(h,n,u){var l=(h.files?h.files:null);var v=(h.fileUploadMethod?h.fileUploadMethod:"multipart");var k=(h.url?h.url:null);n=n?n:(h.success?h.success:undefined);u=u?u:(h.error?h.error:undefined);var j=(h.username?h.username:null);var d=(h.password?h.password:null);var z=(h.accepts?h.accepts:["*/*"]);var r=(h.cache?h.cache:false);var x=(h.contentType?h.contentType:null);var A=(h.data?h.data:null);var t=(h.dataType?h.dataType:null);var f=(h.headers?h.headers:{});var o=(h.timeout?h.timeout:60000);var i=(h.type?h.type:null);if(!i&&l){i="POST"}else{if(!i){i="GET"}}var m=h.progress?h.progress:null;if(typeof z==="string"){z=[z]}var w=null;if(l){if(v=="multipart"){w=forge.tools.UUID().replace(/-/g,"");A=c(A,w);x="multipart/form-data; boundary="+w}else{if(v=="raw"){if(l.length>1){forge.logging.warning("Only one file can be uploaded at once with type 'raw'");l=[l[0]]}A=null;if(!x){x="image/jpg"}}}}else{if(i=="GET"){k=a(k,A);A=null}else{if(A){A=b(A);if(!x){x="application/x-www-form-urlencoded"}}}}if(r){r={};r["wm"+Math.random()]=Math.random();k=a(k,r)}if(z){f.Accept=z.join(",")}if(x){f["Content-Type"]=x}var s={};if(window._forgeDebug){try{s.id=forge.tools.UUID();s.fromUrl=window.location.href;s.reqTime=(new Date()).getTime()/1000;s.method=i;s.data=A;s.url=k;_forgeDebug.wi.NetworkNotify.identifierForInitialRequest(s.id,s.url,{url:s.fromUrl,frameId:0,loaderId:0},[]);_forgeDebug.wi.NetworkNotify.willSendRequest(s.id,s.reqTime,{url:s.url,httpMethod:s.method,httpHeaderFields:{},requestFormData:s.data},{isNull:true})}catch(y){}}var q=false;var p=setTimeout(function(){if(q){return}q=true;if(window._forgeDebug){try{s.respTime=(new Date()).getTime()/1000;s.respText=A;_forgeDebug.wi.NetworkNotify.didReceiveResponse(s.id,s.reqTime,"XHR",{mimeType:"Unknown",textEncodingName:"",httpStatusCode:1,httpStatusText:"Failure",httpHeaderFields:{},connectionReused:false,connectionID:0,wasCached:false});_forgeDebug.wi.NetworkNotify.setInitialContent(s.id,s.respText,"XHR");_forgeDebug.wi.NetworkNotify.didFinishLoading(s.id,s.respTime)}catch(B){}}u&&u({message:"Request timed out",type:"EXPECTED_FAILURE"})},o);var g=null;if(m!==null){g=forge.tools.UUID();forge.internal.addEventListener("request.progress."+g,m)}forge.internal.call("request.ajax",{url:k,username:j,password:d,data:A,headers:f,timeout:o,type:i,boundary:w,files:l,fileUploadMethod:v,progress:g},function(C){var E=C.response,G=C.headers;clearTimeout(p);if(q){return}q=true;if(window._forgeDebug){try{s.respTime=(new Date()).getTime()/1000;s.respText=E;_forgeDebug.wi.NetworkNotify.didReceiveResponse(s.id,s.reqTime,"XHR",{mimeType:"Unknown",textEncodingName:"",httpStatusCode:1,httpStatusText:"Success",httpHeaderFields:{},connectionReused:false,connectionID:0,wasCached:false});_forgeDebug.wi.NetworkNotify.setInitialContent(s.id,s.respText,"XHR");_forgeDebug.wi.NetworkNotify.didFinishLoading(s.id,s.respTime)}catch(F){}}try{if(t=="xml"){var D,B;if(window.DOMParser){D=new DOMParser();B=D.parseFromString(E,"text/xml")}else{B=new ActiveXObject("Microsoft.XMLDOM");B.async="false";B.loadXML(E)}E=B}else{if(t=="json"){E=JSON.parse(E)}}}catch(F){}n&&n(E,G)},function(){clearTimeout(p);if(q){return}q=true;if(window._forgeDebug){try{s.respTime=(new Date()).getTime()/1000;s.respText=A;_forgeDebug.wi.NetworkNotify.didReceiveResponse(s.id,s.reqTime,"XHR",{mimeType:"Unknown",textEncodingName:"",httpStatusCode:1,httpStatusText:"Failure",httpHeaderFields:{},connectionReused:false,connectionID:0,wasCached:false});_forgeDebug.wi.NetworkNotify.setInitialContent(s.id,s.respText,"XHR");_forgeDebug.wi.NetworkNotify.didFinishLoading(s.id,s.respTime)}catch(B){}}u&&u.apply(this,arguments)})}})();